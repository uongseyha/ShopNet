import{o as f}from"./chunk-74Z4WQG3.js";import{Q as l,U as d,Z as m,p as s,pa as h,q as u,rc as p}from"./chunk-MW44NC5E.js";var b="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var g=(o=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(o|=0));for(;o--;)t+=b[e[o]&63];return t};var a=class{id=g();items=[];deliveryMethodId;paymentIntentId;clientSecret;coupon};var C={production:!1,baseUrl:"https://localhost:5001/api/",hubUrl:"https://localhost:5001/hub/notifications",stripePublicKey:""};var I=class o{baseUrl=C.baseUrl+"cart";http=m(f);cart=h(null);itemCount=p(()=>this.cart()?.items.reduce((t,e)=>t+e.quantity,0));totals=p(()=>{let t=this.cart();if(!t)return null;let e=t.items.reduce((y,c)=>y+c.price*c.quantity,0),r=0;t.coupon&&(console.log(t),t.coupon.amountOff?r=t.coupon.amountOff:t.coupon.percentOff&&(r=e*(t.coupon.percentOff/100)));let n=0,i=e+n-r;return{subtotal:e,shipping:n,discount:r,total:i}});applyDiscount(t){return this.http.get(this.baseUrl+"coupons/"+t)}getCart(t){return this.http.get(this.baseUrl+"?id="+t).pipe(u(e=>(this.cart.set(e),e)))}setCart(t){return this.http.post(this.baseUrl,t).pipe(l(e=>{this.cart.set(e)}))}async addItemToCart(t,e=1){let r=this.cart()??this.createCart();this.isProduct(t)&&(t=this.mapProductToCartItem(t)),r.items=this.addOrUpdateItem(r.items,t,e),await s(this.setCart(r))}async removeItemFromCart(t,e=1){let r=this.cart();if(!r)return;let n=r.items.findIndex(i=>i.productId===t);n!==-1&&(r.items[n].quantity>e?r.items[n].quantity-=e:r.items.splice(n,1),r.items.length===0?this.deleteCart():await s(this.setCart(r)))}deleteCart(){this.http.delete(this.baseUrl+"?id="+this.cart()?.id).subscribe({next:()=>{localStorage.removeItem("cart_id"),this.cart.set(null)}})}addOrUpdateItem(t,e,r){let n=t.findIndex(i=>i.productId===e.productId);return n===-1?(e.quantity=r,t.push(e)):t[n].quantity+=r,t}mapProductToCartItem(t){return{productId:t.id,productName:t.name,price:t.price,quantity:0,pictureUrl:t.pictureUrl,brand:t.brand,type:t.type}}isProduct(t){return t.id!==void 0}createCart(){let t=new a;return localStorage.setItem("cart_id",t.id),t}static \u0275fac=function(e){return new(e||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{C as a,I as b};
